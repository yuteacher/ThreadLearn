7 3 工 作 原 理 
当 程 序 运 行 时 ， 我 们 创 建 了 一 个 LINQ 查 洵 ， 其 使 用 反 射 API 来 查 询 加 载 到 当 前 应 用 程 序 域 中 的 所 有 组 件 中 名 称 以 “ web ” 开 头 的 类 型 。 我 们 使 用 方 法 模 拟 处
理 每 个 项 时 间 的 延 迟 ， 并 使 用 PrintInfo 方 法 打 印 结 果 。 我 们 也 使 用 了 stopwatch 类 来 测 量 每 个 查 询 的 执 行 时 间 。 首 先 我 们 运 行 了 一 个 通 常 的 顺 序 LINQ 查 询 。 此
时 并 没 有 并 行 化 ， 所 有 任 何 操 作 都 运 行 在 当 前 线 程 。 该 查 询 的 第 二 版 显 式 地 使 用 了 ParallelEnumerable 类 。 ParallelEnumerable 包 含 了 PLINQ 的 逻 辑 实 现 ， 并 且 作 为
IEnumerable 集 合 功 能 的 一 组 扩 展 方 法 。 通 常 无 需 显 式 地 使 用 该 类 ， 在 这 里 是 为 了 演 示 PLINQ 的 实 际 工 作 方 式 。 第 二 个 版 本 以 并 行 的 方 式 运 行 操 作 。 然 而 ，
默 认 情 况 下 结 果 会 被 合 并 到 单 个 线 程 中 ， 所 以 查 询 的 执 行 时 间 应 该 比 第 一 个 版 本 少 几 秒 第 三 个 版 本 展 示 了 如 何 使 用 AsParallel 方 法 来 将 LINQ 查 询 按 声 明 的 方
式 并 行 化 运 行 。 这 里 我 们 并 不 关 心 实 现 细 节 ， 只 是 为 了 说 明 我 们 想 以 并 行 的 方 式 运 行 。 然 而 ． 该 版 本 的 关 键 不 同 处 是 我 们 使 用 了 ForAII 方 法 来 打 印 查 询 结 
果 。 打 印 结 果 操 作 与 任 务 被 处 理 的 线 程 是 同 一 个 线 程 ， 跳 过 了 结 果 合 并 步 骤 。 它 允 许 我 们 也 能 以 并 行 的 方 式 运 行 Print1nfi 。 方 法 ， 甚 至 该 版 本 运 行 速 度 比 
之 前 的 版 本 更 快 最 后 一 个 例 子 展 示 了 如 何 使 用 AsSequential 方 法 将 PLINQ 查 询 以 顺 序 方 式 运 行 。 可 以 看 到 该 查 询 运 行 方 式 与 第 一 个 示 例 完 全 一 样